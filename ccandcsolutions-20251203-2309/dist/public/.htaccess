<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Set DirectoryIndex to serve index.html first
  DirectoryIndex index.html index.htm default.html

  # Force text/html content type for all .html files
  <FilesMatch "\.html?$">
    ForceType text/html
    Header set Content-Type "text/html; charset=UTF-8"
    Header set Content-Disposition "inline"
  </FilesMatch>

  # Add handler for HTML files
  AddHandler text/html html htm

  # Ensure JavaScript files are served as JavaScript
  <FilesMatch "\.js$">
    AddType application/javascript js
    Header set Content-Type "application/javascript"
  </FilesMatch>

  # Ensure CSS files are served as CSS
  <FilesMatch "\.css$">
    AddType text/css css
    Header set Content-Type "text/css"
  </FilesMatch>

  # Security headers
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set X-XSS-Protection "1; mode=block"

  # Compression
  <IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
  </IfModule>

  # Caching
  <FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$">
    Header set Cache-Control "max-age=31536000, public"
  </FilesMatch>
  
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "max-age=3600, public, must-revalidate"
  </FilesMatch>

  # Permissions
  Options -Indexes +FollowSymLinks

  # Prevent direct access to sensitive files
  <FilesMatch "^\.">
    Order allow,deny
    Deny from all
  </FilesMatch>

  # SPA routing - serve index.html for all non-existent files/directories
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.html [QSA,L]
</IfModule>
